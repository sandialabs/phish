<HTML>
<CENTER><A HREF = "Bait.html">Previous Section</A> - <A HREF = "http://phish.sandia.gov">PHISH WWW Site</A> -
<A HREF = "Manual.html">LAMMPS Documentation</A> - <A HREF = "Library.html">Next Section</A> 
</CENTER>




<HR>

<H3>3. PHISH Minnows 
</H3>
<P>In PHISH lingo, a "minnow" is a stand-alone application which makes
calls to the <A HREF = "Library.html">PHISH library</A>.  Typically they are small
programs which perform a single task, e.g. they parse a string into
keywords and store statistics on those keywords.
</P>
<P>Hooked together by connections to other sets of minnows, in various
communication patterns
</P>
<P>Often come in sets as specified by input script.  Parallel if working
in tandem with other duplicate minnows, each processing a subset of
datums.
</P>
<P>minnow vs shark vs whale
</P>
<P>This doc page covers these topics:
</P>
<UL><LI>3.1 <A HREF = "#minnow_1">List of minnows</A>
<LI>3.2 <A HREF = "#minnow_2">Code structure of a minnow</A>
<LI>3.3 <A HREF = "#minnow_3">Communication via ports</A>
<LI>3.4 <A HREF = "#minnow_4">Shutting down a minnow</A>
<LI>3.5 <A HREF = "#minnow_5">Building a minnow</A> 
</UL>
<HR>

<HR>

<A NAME = "minnow_1"></A><H4>3.1 List of minnows 
</H4>
<P>This is a list of minnows in the minnow directory of the PHISH
distribution.  Each has its own doc page.  Some are written in C++,
some in Python, some in both:
</P>
<UL><LI><A HREF = "count.html">count</A>
<LI><A HREF = "file2fields.html">file2fields</A>
<LI><A HREF = "file2words.html">file2words</A>
<LI><A HREF = "filegen.html">filegen</A>
<LI><A HREF = "ping.html">ping</A>
<LI><A HREF = "pong.html">pong</A>
<LI><A HREF = "print.html">print</A>
<LI><A HREF = "readgraph.html">readgraph</A>
<LI><A HREF = "rmat.html">rmat</A>
<LI><A HREF = "slowdown.html">slowdown</A>
<LI><A HREF = "sort.html">sort</A> 
</UL>
<P>These are special minnows which can wrap stand-alone non-PHISH
programs which read from stdin and write to stdout, so that they can
be used in as minnows in a PHISH program:
</P>
<UL><LI><A HREF = "wrapsink.html">wrapsink</A>
<LI><A HREF = "wrapsource.html">wrapsource</A>
<LI><A HREF = "wrapss.html">wrapss</A> 
</UL>
<P>These are simple stand-alone programs that are examples of code that
can be wrapped by the "wrap" minnows:
</P>
<UL><LI><A HREF = "echo.html">echo</A>
<LI><A HREF = "reverse.html">reverse</A> 
</UL>
<HR>

<A NAME = "minnow_2"></A><H4>3.2 Code structure of a minnow 
</H4>
<P>Use count.py, is same in C
</P>
<P>Best way to make sense of what a minnow does is examine a few
simple ones from the minnow dir.
</P>
<P>command line args
setup calls to lib
setting callbacks
</P>
<P>when to make various kinds of lib calls
</P>
<P>Deinfe ports as in connect command
</P>
<P>loop vs probe vs recv
</P>
<P>receving and unpacking a datum
</P>
<P>packing and sending a datum
</P>
<PRE>1   #!/usr/local/bin/python
2
3   import sys,os,glob,copy
4   import phish
5
6   def count(nvalues):
7     if nvalues != 1: phish.error("Count processes one-value datums")
8     type,str,tmp = phish.unpack()
9     if type != phish.STRING:
10      phish.error("File2words processes string values")
11    if hash.has_key(str): hash<B>str</B> = hash<B>str</B> + 1
12    else: hash<B>str</B> = 1
13
14  def sort():
15    pairs = hash.items()
16    for key,value in pairs:
17      phish.pack_int(value)
18      phish.pack_string(key)
19      phish.send(0)
20
21  args = phish.init(sys.argv)
22  phish.input(0,count,sort,1)
23  phish.output(0)
24  phish.check()
25
26  if len(args) != 0: phish.error("Count syntax: count")
27
28  hash = <I></I>
29  
30  phish.loop()
31  phish.exit() 
</PRE>
<HR>

<A NAME = "minnow_3"></A><H4>3.3 Communication via ports 
</H4>
<P>rules about ports
</P>
<HR>

<A NAME = "minnow_4"></A><H4>3.4 Shutting down a minnow 
</H4>
<P>regular datum vs done message
</P>
<P>For a PHISH program whose minnows operate in a pipelined
one-directional fashion (e.g. one or more minnows read input,
send datums to a 2nd set of minnows, on to a 3rd set, etc), it
is typically sufficient to trigger an orderly shutdown of
the entire program 
</P>
<P>one-way schools, triggered by head
done messages, per port level
close ports explicitly or implicitly
calls to exit, close, etc
special care for ring or chain connections
or when school has loops
Ctrl-C option
output at end
</P>
<P>shutdown in ZMQ is buggy
</P>
<HR>

<A NAME = "minnow_5"></A><H4>3.5 Building a minnow 
</H4>
<P>makefile
</P>
<P>debug a school in stages, since no connection
to an output ports is required, or could just hook output to
a print minnow
</P>
<P>use of slowdown minnow to throttle
</P>
</HTML>
